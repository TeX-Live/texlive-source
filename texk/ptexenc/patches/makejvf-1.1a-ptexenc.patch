Index: configure
===================================================================
--- makejvf-1.1a.orig/configure
+++ makejvf-1.1a/configure
@@ -1,9 +1,7 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.63 for makeindex for TeX Live 2.15.
+# Generated by GNU Autoconf 2.63 for makejvf for TeX Live 1.1a.
 #
-# Report bugs to <tex-k@tug.org>.
-#
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 # 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
@@ -743,13 +741,13 @@
 SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
-PACKAGE_NAME='makeindex for TeX Live'
-PACKAGE_TARNAME='makeindex-for-tex-live'
-PACKAGE_VERSION='2.15'
-PACKAGE_STRING='makeindex for TeX Live 2.15'
-PACKAGE_BUGREPORT='tex-k@tug.org'
+PACKAGE_NAME='makejvf for TeX Live'
+PACKAGE_TARNAME='makejvf-for-tex-live'
+PACKAGE_VERSION='1.1a'
+PACKAGE_STRING='makejvf for TeX Live 1.1a'
+PACKAGE_BUGREPORT=''
 
-ac_unique_file="mkind.c"
+ac_unique_file="main.c"
 # Factoring default headers for most tests.
 ac_includes_default="\
 #include <stdio.h>
@@ -790,6 +788,10 @@
 am__EXEEXT_TRUE
 LTLIBOBJS
 LIBOBJS
+PTEXENC_RULE
+PTEXENC_DEPEND
+PTEXENC_LIBS
+PTEXENC_INCLUDES
 KPATHSEA_RULE
 KPATHSEA_DEPEND
 KPATHSEA_LIBS
@@ -1480,7 +1482,7 @@
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures makeindex for TeX Live 2.15 to adapt to many kinds of systems.
+\`configure' configures makejvf for TeX Live 1.1a to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1529,7 +1531,7 @@
   --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
   --mandir=DIR            man documentation [DATAROOTDIR/man]
   --docdir=DIR            documentation root
-                          [DATAROOTDIR/doc/makeindex-for-tex-live]
+                          [DATAROOTDIR/doc/makejvf-for-tex-live]
   --htmldir=DIR           html documentation [DOCDIR]
   --dvidir=DIR            dvi documentation [DOCDIR]
   --pdfdir=DIR            pdf documentation [DOCDIR]
@@ -1551,7 +1553,7 @@
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of makeindex for TeX Live 2.15:";;
+     short | recursive ) echo "Configuration of makejvf for TeX Live 1.1a:";;
    esac
   cat <<\_ACEOF
 
@@ -1598,7 +1600,6 @@
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
 
-Report bugs to <tex-k@tug.org>.
 _ACEOF
 ac_status=$?
 fi
@@ -1661,7 +1662,7 @@
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-makeindex for TeX Live configure 2.15
+makejvf for TeX Live configure 1.1a
 generated by GNU Autoconf 2.63
 
 Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
@@ -1675,7 +1676,7 @@
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by makeindex for TeX Live $as_me 2.15, which was
+It was created by makejvf for TeX Live $as_me 1.1a, which was
 generated by GNU Autoconf 2.63.  Invocation command line was
 
   $ $0 $@
@@ -4328,13 +4329,13 @@
 else
   lt_cv_nm_interface="BSD nm"
   echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:4331: $ac_compile\"" >&5)
+  (eval echo "\"\$as_me:4332: $ac_compile\"" >&5)
   (eval "$ac_compile" 2>conftest.err)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:4334: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
+  (eval echo "\"\$as_me:4335: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:4337: output\"" >&5)
+  (eval echo "\"\$as_me:4338: output\"" >&5)
   cat conftest.out >&5
   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
     lt_cv_nm_interface="MS dumpbin"
@@ -5540,7 +5541,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 5543 "configure"' > conftest.$ac_ext
+  echo '#line 5544 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -6934,8 +6935,8 @@
 
 
 # Define the identity of the package.
- PACKAGE='makeindex-for-tex-live'
- VERSION='2.15'
+ PACKAGE='makejvf-for-tex-live'
+ VERSION='1.1a'
 
 
 # Some tools Automake needs.
@@ -7492,11 +7493,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7495: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7496: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7499: \$? = $ac_status" >&5
+   echo "$as_me:7500: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7831,11 +7832,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7834: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7835: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7838: \$? = $ac_status" >&5
+   echo "$as_me:7839: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7936,11 +7937,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7939: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7940: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:7943: \$? = $ac_status" >&5
+   echo "$as_me:7944: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -7991,11 +7992,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7994: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7995: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:7998: \$? = $ac_status" >&5
+   echo "$as_me:7999: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -10791,7 +10792,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10794 "configure"
+#line 10795 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10887,7 +10888,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10890 "configure"
+#line 10891 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -12237,12 +12238,7 @@
 $as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
     { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
 $as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ---------------------------- ##
-## Report this to tex-k@tug.org ##
-## ---------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
+
     ;;
 esac
 { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
@@ -12934,9 +12930,7 @@
 
 
 
-
-
-for ac_header in ctype.h types.h locale.h
+for ac_header in strings.h
 do
 as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
@@ -13054,12 +13048,7 @@
 $as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
     { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
 $as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ---------------------------- ##
-## Report this to tex-k@tug.org ##
-## ---------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
+
     ;;
 esac
 { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
@@ -13088,8 +13077,7 @@
 
 
 
-
-for ac_func in strchr strrchr setlocale
+for ac_func in strdup strtol
 do
 as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 { $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
@@ -13529,7 +13517,7 @@
 Report bugs to <bug-libtool@gnu.org>."
 
 lt_cl_version="\
-makeindex for TeX Live config.lt 2.15
+makejvf for TeX Live config.lt 1.1a
 configured by $0, generated by GNU Autoconf 2.63.
 
 Copyright (C) 2008 Free Software Foundation, Inc.
@@ -14529,7 +14517,22 @@
 	cd ${top_builddir}/../kpathsea && $(MAKE) $(AM_MAKEFLAGS)'
 fi
 
+## _KPSE_LIB_FLAGS: Setup ptexenc (-lptexenc) flags
+  PTEXENC_INCLUDES=`echo '-IBLD/texk -ISRC/texk' | sed \
+    -e "s,SRC/,$kpse_SRC/,g" \
+    -e "s,BLD/,$kpse_BLD/,g"`
+  PTEXENC_LIBS=`echo 'BLD/texk/ptexenc/libptexenc.la' | sed \
+    -e "s,BLD/,$kpse_BLD/,g"`
 
+  PTEXENC_DEPEND=`echo 'BLD/texk/ptexenc/libptexenc.la' | sed \
+    -e 's,BLD/,${top_builddir}/../../,g'`
+   PTEXENC_RULE='# Rebuild libptexenc
+$(PTEXENC_DEPEND): ${top_srcdir}/../ptexenc/*.[ch] ${top_builddir}/../ptexenc/ptexenc.h
+	cd ${top_builddir}/../../libs/ptexenc && $(MAKE) $(AM_MAKEFLAGS)
+${top_builddir}/../ptexenc/ptexenc.h:
+	cd ${top_builddir}/../../libs/ptexenc && $(MAKE) $(AM_MAKEFLAGS)'
+
+
 ac_config_files="$ac_config_files Makefile"
 
 
@@ -14981,7 +14984,7 @@
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by makeindex for TeX Live $as_me 2.15, which was
+This file was extended by makejvf for TeX Live $as_me 1.1a, which was
 generated by GNU Autoconf 2.63.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
@@ -15044,7 +15047,7 @@
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_version="\\
-makeindex for TeX Live config.status 2.15
+makejvf for TeX Live config.status 1.1a
 configured by $0, generated by GNU Autoconf 2.63,
   with options \\"`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
 

Property changes on: configure
___________________________________________________________________
Modified: svn:executable
   - 
   + *

Index: Makefile.in
===================================================================
--- makejvf-1.1a.orig/Makefile.in
+++ makejvf-1.1a/Makefile.in
@@ -15,7 +15,6 @@
 
 @SET_MAKE@
 
-
 VPATH = @srcdir@
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
@@ -35,10 +34,10 @@
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
-bin_PROGRAMS = makeindex$(EXEEXT)
+bin_PROGRAMS = makejvf$(EXEEXT)
 subdir = .
-DIST_COMMON = README $(am__configure_deps) $(dist_bin_SCRIPTS) \
-	$(dist_man1_MANS) $(srcdir)/../../build-aux/config.guess \
+DIST_COMMON = $(am__configure_deps) \
+	$(srcdir)/../../build-aux/config.guess \
 	$(srcdir)/../../build-aux/config.sub \
 	$(srcdir)/../../build-aux/depcomp \
 	$(srcdir)/../../build-aux/install-sh \
@@ -50,11 +49,11 @@
 	../../build-aux/config.sub ../../build-aux/depcomp \
 	../../build-aux/install-sh ../../build-aux/ltmain.sh \
 	../../build-aux/missing ../../build-aux/mkinstalldirs \
-	../../build-aux/texinfo.tex ../../build-aux/ylwrap COPYING \
-	ChangeLog INSTALL NEWS
+	../../build-aux/texinfo.tex ../../build-aux/ylwrap
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/../../m4/kpse-common.m4 \
 	$(top_srcdir)/../../m4/kpse-kpathsea-flags.m4 \
+	$(top_srcdir)/../../m4/kpse-ptexenc-flags.m4 \
 	$(top_srcdir)/../../m4/kpse-warnings.m4 \
 	$(top_srcdir)/../../m4/libtool.m4 \
 	$(top_srcdir)/../../m4/ltoptions.m4 \
@@ -70,37 +69,13 @@
 CONFIG_HEADER = c-auto.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
-am__installdirs = "$(DESTDIR)$(bindir)" "$(DESTDIR)$(bindir)" \
-	"$(DESTDIR)$(man1dir)"
+am__installdirs = "$(DESTDIR)$(bindir)"
 PROGRAMS = $(bin_PROGRAMS)
-am_makeindex_OBJECTS = genind.$(OBJEXT) mkind.$(OBJEXT) \
-	qsort.$(OBJEXT) scanid.$(OBJEXT) scanst.$(OBJEXT) \
-	sortid.$(OBJEXT)
-makeindex_OBJECTS = $(am_makeindex_OBJECTS)
-makeindex_LDADD = $(LDADD)
+am_makejvf_OBJECTS = main.$(OBJEXT) tfmread.$(OBJEXT) tool.$(OBJEXT) \
+	write.$(OBJEXT)
+makejvf_OBJECTS = $(am_makejvf_OBJECTS)
+makejvf_LDADD = $(LDADD)
 am__DEPENDENCIES_1 =
-am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
-am__vpath_adj = case $$p in \
-    $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
-    *) f=$$p;; \
-  esac;
-am__strip_dir = f=`echo $$p | sed -e 's|^.*/||'`;
-am__install_max = 40
-am__nobase_strip_setup = \
-  srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*|]/\\\\&/g'`
-am__nobase_strip = \
-  for p in $$list; do echo "$$p"; done | sed -e "s|$$srcdirstrip/||"
-am__nobase_list = $(am__nobase_strip_setup); \
-  for p in $$list; do echo "$$p $$p"; done | \
-  sed "s| $$srcdirstrip/| |;"' / .*\//!s/ .*/ ./; s,\( .*\)/[^/]*$$,\1,' | \
-  $(AWK) 'BEGIN { files["."] = "" } { files[$$2] = files[$$2] " " $$1; \
-    if (++n[$$2] == $(am__install_max)) \
-      { print $$2, files[$$2]; n[$$2] = 0; files[$$2] = "" } } \
-    END { for (dir in files) print dir, files[dir] }'
-am__base_list = \
-  sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
-  sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
-SCRIPTS = $(dist_bin_SCRIPTS)
 DEFAULT_INCLUDES = -I.@am__isrc@
 depcomp = $(SHELL) $(top_srcdir)/../../build-aux/depcomp
 am__depfiles_maybe = depfiles
@@ -114,11 +89,8 @@
 LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \
 	$(LDFLAGS) -o $@
-SOURCES = $(makeindex_SOURCES)
-DIST_SOURCES = $(makeindex_SOURCES)
-man1dir = $(mandir)/man1
-NROFF = nroff
-MANS = $(dist_man1_MANS)
+SOURCES = $(makejvf_SOURCES)
+DIST_SOURCES = $(makejvf_SOURCES)
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -188,6 +160,9 @@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
+PTEXENC_DEPEND = @PTEXENC_DEPEND@
+PTEXENC_INCLUDES = @PTEXENC_INCLUDES@
+PTEXENC_LIBS = @PTEXENC_LIBS@
 RANLIB = @RANLIB@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
@@ -248,26 +223,14 @@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 ACLOCAL_AMFLAGS = -I ../../m4
-INCLUDES = $(KPATHSEA_INCLUDES)
-AM_CPPFLAGS = -DUNIX -DKPATHSEA
+INCLUDES = $(KPATHSEA_INCLUDES) $(PTEXENC_INCLUDES)
 AM_CFLAGS = $(WARNING_CFLAGS)
-dist_bin_SCRIPTS = mkindex
-makeindex_SOURCES = \
-	genind.c \
-	genind.h \
-	mkind.c \
-	mkind.h \
-	qsort.c \
-	scanid.c \
-	scanid.h \
-	scanst.c \
-	scanst.h \
-	sortid.c
+makejvf_SOURCES = \
+	main.c  makejvf.h  tfmread.c  tool.c  write.c
 
-makeindex_DEPENDENCIES = $(KPATHSEA_DEPEND)
-LDADD = $(KPATHSEA_LIBS)	
-dist_man1_MANS = makeindex.1 mkindex.1
-EXTRA_DIST = ACK CONTRIB FILES NOTES PORTING
+makejvf_DEPENDENCIES = $(KPATHSEA_DEPEND) $(PTEXENC_DEPEND)
+LDADD = $(PTEXENC_LIBS) $(KPATHSEA_LIBS)
+EXTRA_DIST = COPYRIGHT COPYRIGHT.jis Changes.txt README.txt
 all: c-auto.h
 	$(MAKE) $(AM_MAKEFLAGS) all-am
 
@@ -367,56 +330,20 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-makeindex$(EXEEXT): $(makeindex_OBJECTS) $(makeindex_DEPENDENCIES) 
-	@rm -f makeindex$(EXEEXT)
-	$(LINK) $(makeindex_OBJECTS) $(makeindex_LDADD) $(LIBS)
-install-dist_binSCRIPTS: $(dist_bin_SCRIPTS)
-	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
-	@list='$(dist_bin_SCRIPTS)'; test -n "$(bindir)" || list=; \
-	for p in $$list; do \
-	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
-	  if test -f "$$d$$p"; then echo "$$d$$p"; echo "$$p"; else :; fi; \
-	done | \
-	sed -e 'p;s,.*/,,;n' \
-	    -e 'h;s|.*|.|' \
-	    -e 'p;x;s,.*/,,;$(transform)' | sed 'N;N;N;s,\n, ,g' | \
-	$(AWK) 'BEGIN { files["."] = ""; dirs["."] = 1; } \
-	  { d=$$3; if (dirs[d] != 1) { print "d", d; dirs[d] = 1 } \
-	    if ($$2 == $$4) { files[d] = files[d] " " $$1; \
-	      if (++n[d] == $(am__install_max)) { \
-		print "f", d, files[d]; n[d] = 0; files[d] = "" } } \
-	    else { print "f", d "/" $$4, $$1 } } \
-	  END { for (d in files) print "f", d, files[d] }' | \
-	while read type dir files; do \
-	     if test "$$dir" = .; then dir=; else dir=/$$dir; fi; \
-	     test -z "$$files" || { \
-	       echo " $(INSTALL_SCRIPT) $$files '$(DESTDIR)$(bindir)$$dir'"; \
-	       $(INSTALL_SCRIPT) $$files "$(DESTDIR)$(bindir)$$dir" || exit $$?; \
-	     } \
-	; done
+makejvf$(EXEEXT): $(makejvf_OBJECTS) $(makejvf_DEPENDENCIES) 
+	@rm -f makejvf$(EXEEXT)
+	$(LINK) $(makejvf_OBJECTS) $(makejvf_LDADD) $(LIBS)
 
-uninstall-dist_binSCRIPTS:
-	@$(NORMAL_UNINSTALL)
-	@list='$(dist_bin_SCRIPTS)'; test -n "$(bindir)" || exit 0; \
-	files=`for p in $$list; do echo "$$p"; done | \
-	       sed -e 's,.*/,,;$(transform)'`; \
-	test -n "$$list" || exit 0; \
-	echo " ( cd '$(DESTDIR)$(bindir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(bindir)" && rm -f $$files
-
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/genind.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mkind.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/qsort.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/scanid.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/scanst.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/sortid.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tfmread.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tool.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write.Po@am__quote@
 
 .c.o:
 @am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
@@ -447,41 +374,7 @@
 
 distclean-libtool:
 	-rm -f libtool config.lt
-install-man1: $(dist_man1_MANS)
-	@$(NORMAL_INSTALL)
-	test -z "$(man1dir)" || $(MKDIR_P) "$(DESTDIR)$(man1dir)"
-	@list='$(dist_man1_MANS)'; test -n "$(man1dir)" || exit 0; \
-	{ for i in $$list; do echo "$$i"; done; \
-	} | while read p; do \
-	  if test -f $$p; then d=; else d="$(srcdir)/"; fi; \
-	  echo "$$d$$p"; echo "$$p"; \
-	done | \
-	sed -e 'n;s,.*/,,;p;h;s,.*\.,,;s,^[^1][0-9a-z]*$$,1,;x' \
-	      -e 's,\.[0-9a-z]*$$,,;$(transform);G;s,\n,.,' | \
-	sed 'N;N;s,\n, ,g' | { \
-	list=; while read file base inst; do \
-	  if test "$$base" = "$$inst"; then list="$$list $$file"; else \
-	    echo " $(INSTALL_DATA) '$$file' '$(DESTDIR)$(man1dir)/$$inst'"; \
-	    $(INSTALL_DATA) "$$file" "$(DESTDIR)$(man1dir)/$$inst" || exit $$?; \
-	  fi; \
-	done; \
-	for i in $$list; do echo "$$i"; done | $(am__base_list) | \
-	while read files; do \
-	  test -z "$$files" || { \
-	    echo " $(INSTALL_DATA) $$files '$(DESTDIR)$(man1dir)'"; \
-	    $(INSTALL_DATA) $$files "$(DESTDIR)$(man1dir)" || exit $$?; }; \
-	done; }
 
-uninstall-man1:
-	@$(NORMAL_UNINSTALL)
-	@list='$(dist_man1_MANS)'; test -n "$(man1dir)" || exit 0; \
-	files=`{ for i in $$list; do echo "$$i"; done; \
-	} | sed -e 's,.*/,,;h;s,.*\.,,;s,^[^1][0-9a-z]*$$,1,;x' \
-	      -e 's,\.[0-9a-z]*$$,,;$(transform);G;s,\n,.,'`; \
-	test -z "$$files" || { \
-	  echo " ( cd '$(DESTDIR)$(man1dir)' && rm -f" $$files ")"; \
-	  cd "$(DESTDIR)$(man1dir)" && rm -f $$files; }
-
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
@@ -535,19 +428,6 @@
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@list='$(MANS)'; if test -n "$$list"; then \
-	  list=`for p in $$list; do \
-	    if test -f $$p; then d=; else d="$(srcdir)/"; fi; \
-	    if test -f "$$d$$p"; then echo "$$d$$p"; else :; fi; done`; \
-	  if test -n "$$list" && \
-	    grep 'ab help2man is required to generate this page' $$list >/dev/null; then \
-	    echo "error: found man pages containing the \`missing help2man' replacement text:" >&2; \
-	    grep -l 'ab help2man is required to generate this page' $$list | sed 's/^/         /' >&2; \
-	    echo "       to fix them, install help2man, remove and regenerate the man pages;" >&2; \
-	    echo "       typically \`make maintainer-clean' will remove them" >&2; \
-	    exit 1; \
-	  else :; fi; \
-	else :; fi
 	$(am__remove_distdir)
 	test -d "$(distdir)" || mkdir "$(distdir)"
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
@@ -695,9 +575,9 @@
 	       exit 1; } >&2
 check-am: all-am
 check: check-am
-all-am: Makefile $(PROGRAMS) $(SCRIPTS) $(MANS) c-auto.h
+all-am: Makefile $(PROGRAMS) c-auto.h
 installdirs:
-	for dir in "$(DESTDIR)$(bindir)" "$(DESTDIR)$(bindir)" "$(DESTDIR)$(man1dir)"; do \
+	for dir in "$(DESTDIR)$(bindir)"; do \
 	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
 	done
 install: install-am
@@ -748,13 +628,13 @@
 
 info-am:
 
-install-data-am: install-man
+install-data-am:
 
 install-dvi: install-dvi-am
 
 install-dvi-am:
 
-install-exec-am: install-binPROGRAMS install-dist_binSCRIPTS
+install-exec-am: install-binPROGRAMS
 
 install-html: install-html-am
 
@@ -764,7 +644,7 @@
 
 install-info-am:
 
-install-man: install-man1
+install-man:
 
 install-pdf: install-pdf-am
 
@@ -796,11 +676,8 @@
 
 ps-am:
 
-uninstall-am: uninstall-binPROGRAMS uninstall-dist_binSCRIPTS \
-	uninstall-man
+uninstall-am: uninstall-binPROGRAMS
 
-uninstall-man: uninstall-man1
-
 .MAKE: all install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am am--refresh check check-am clean \
@@ -810,20 +687,19 @@
 	distclean-generic distclean-hdr distclean-libtool \
 	distclean-tags distcleancheck distdir distuninstallcheck dvi \
 	dvi-am html html-am info info-am install install-am \
-	install-binPROGRAMS install-data install-data-am \
-	install-dist_binSCRIPTS install-dvi install-dvi-am \
-	install-exec install-exec-am install-html install-html-am \
-	install-info install-info-am install-man install-man1 \
+	install-binPROGRAMS install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
 	install-pdf install-pdf-am install-ps install-ps-am \
 	install-strip installcheck installcheck-am installdirs \
 	maintainer-clean maintainer-clean-generic mostlyclean \
 	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
 	pdf pdf-am ps ps-am tags uninstall uninstall-am \
-	uninstall-binPROGRAMS uninstall-dist_binSCRIPTS uninstall-man \
-	uninstall-man1
+	uninstall-binPROGRAMS
 
 
 @KPATHSEA_RULE@
+@PTEXENC_RULE@
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: c-auto.in
===================================================================
--- makejvf-1.1a.orig/c-auto.in
+++ makejvf-1.1a/c-auto.in
@@ -0,0 +1,162 @@
+/* c-auto.in.  Generated from configure.ac by autoheader.  */
+
+/* Define to 1 if the `closedir' function returns void instead of `int'. */
+#undef CLOSEDIR_VOID
+
+/* Define to 1 if you have the <assert.h> header file. */
+#undef HAVE_ASSERT_H
+
+/* Define to 1 if you have the `bcmp' function. */
+#undef HAVE_BCMP
+
+/* Define to 1 if you have the `bcopy' function. */
+#undef HAVE_BCOPY
+
+/* Define to 1 if you have the `bzero' function. */
+#undef HAVE_BZERO
+
+/* Define to 1 if you have the <dirent.h> header file, and it defines `DIR'.
+   */
+#undef HAVE_DIRENT_H
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+#undef HAVE_DLFCN_H
+
+/* Define to 1 if you have the <float.h> header file. */
+#undef HAVE_FLOAT_H
+
+/* Define to 1 if fseeko (and presumably ftello) exists and is declared. */
+#undef HAVE_FSEEKO
+
+/* Define to 1 if you have the `getcwd' function. */
+#undef HAVE_GETCWD
+
+/* Define to 1 if you have the `getwd' function. */
+#undef HAVE_GETWD
+
+/* Define to 1 if you have the `index' function. */
+#undef HAVE_INDEX
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+#undef HAVE_INTTYPES_H
+
+/* Define to 1 if you have the <limits.h> header file. */
+#undef HAVE_LIMITS_H
+
+/* Define to 1 if you have the `memcmp' function. */
+#undef HAVE_MEMCMP
+
+/* Define to 1 if you have the `memcpy' function. */
+#undef HAVE_MEMCPY
+
+/* Define to 1 if you have the <memory.h> header file. */
+#undef HAVE_MEMORY_H
+
+/* Define to 1 if you have the <ndir.h> header file, and it defines `DIR'. */
+#undef HAVE_NDIR_H
+
+/* Define to 1 if you are using GNU libc or otherwise have global variables
+   `program_invocation_name' and `program_invocation_short_name'. */
+#undef HAVE_PROGRAM_INVOCATION_NAME
+
+/* Define to 1 if you have the `putenv' function. */
+#undef HAVE_PUTENV
+
+/* Define to 1 if you have the <pwd.h> header file. */
+#undef HAVE_PWD_H
+
+/* Define to 1 if you have the `rindex' function. */
+#undef HAVE_RINDEX
+
+/* Define to 1 if you have the <stdint.h> header file. */
+#undef HAVE_STDINT_H
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#undef HAVE_STDLIB_H
+
+/* Define to 1 if you have the `strcasecmp' function. */
+#undef HAVE_STRCASECMP
+
+/* Define to 1 if you have the `strchr' function. */
+#undef HAVE_STRCHR
+
+/* Define to 1 if you have the `strdup' function. */
+#undef HAVE_STRDUP
+
+/* Define to 1 if you have the <strings.h> header file. */
+#undef HAVE_STRINGS_H
+
+/* Define to 1 if you have the <string.h> header file. */
+#undef HAVE_STRING_H
+
+/* Define to 1 if you have the `strrchr' function. */
+#undef HAVE_STRRCHR
+
+/* Define to 1 if you have the `strstr' function. */
+#undef HAVE_STRSTR
+
+/* Define to 1 if you have the `strtol' function. */
+#undef HAVE_STRTOL
+
+/* Define to 1 if `st_mtim' is member of `struct stat'. */
+#undef HAVE_STRUCT_STAT_ST_MTIM
+
+/* Define to 1 if you have the <sys/dir.h> header file, and it defines `DIR'.
+   */
+#undef HAVE_SYS_DIR_H
+
+/* Define to 1 if you have the <sys/ndir.h> header file, and it defines `DIR'.
+   */
+#undef HAVE_SYS_NDIR_H
+
+/* Define to 1 if you have the <sys/param.h> header file. */
+#undef HAVE_SYS_PARAM_H
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#undef HAVE_SYS_STAT_H
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#undef HAVE_SYS_TYPES_H
+
+/* Define to 1 if you have the <unistd.h> header file. */
+#undef HAVE_UNISTD_H
+
+/* Define to the sub-directory in which libtool stores uninstalled libraries.
+   */
+#undef LT_OBJDIR
+
+/* Define to the address where bug reports for this package should be sent. */
+#undef PACKAGE_BUGREPORT
+
+/* Define to the full name of this package. */
+#undef PACKAGE_NAME
+
+/* Define to the full name and version of this package. */
+#undef PACKAGE_STRING
+
+/* Define to the one symbol short name of this package. */
+#undef PACKAGE_TARNAME
+
+/* Define to the version of this package. */
+#undef PACKAGE_VERSION
+
+/* Define to 1 if you have the ANSI C header files. */
+#undef STDC_HEADERS
+
+/* Number of bits in a file offset, on hosts where this is settable. */
+#undef _FILE_OFFSET_BITS
+
+/* Define to 1 to make fseeko visible on some hosts (e.g. glibc 2.2). */
+#undef _LARGEFILE_SOURCE
+
+/* Define for large files, on AIX-style hosts. */
+#undef _LARGE_FILES
+
+/* Define to empty if `const' does not conform to ANSI C. */
+#undef const
+
+/* Define to `__inline__' or `__inline' if that's what the C compiler
+   calls it, or to nothing if 'inline' is not supported under any name.  */
+#ifndef __cplusplus
+#undef inline
+#endif
Index: tool.c
===================================================================
--- makejvf-1.1a.orig/tool.c
+++ makejvf-1.1a/tool.c
@@ -2,8 +2,9 @@
 #include <strings.h>
 #include <math.h>
 
-int mquad(p)
-unsigned char *p;
+#include <kpathsea/config.h>
+
+int mquad(unsigned char *p)
 {
 	unsigned int cc;
 
@@ -15,8 +16,7 @@
 	return(cc);
 }
 
-unsigned int utri(p)
-unsigned char *p;
+unsigned int utri(unsigned char *p)
 {
 	unsigned int i,cc;
 	unsigned char fchar[4];
@@ -30,8 +30,7 @@
 	return cc;
 }
 
-int tri(p)
-unsigned char *p;
+int tri(unsigned char *p)
 {
 	int i,cc;
 	unsigned char fchar[4];
@@ -46,8 +45,7 @@
 	return cc;
 }
 
-unsigned int upair(p)
-unsigned char *p;
+unsigned int upair(unsigned char *p)
 {
 	unsigned int i,cc;
 	unsigned char fchar[4];
@@ -61,8 +59,7 @@
 	return cc;
 }
 
-int pair(p)
-unsigned char *p;
+int pair(unsigned char *p)
 {
 	int i,cc;
 	unsigned char fchar[4];
@@ -77,9 +74,7 @@
 	return cc;
 }
 
-int mget(p,num)
-char *p;
-int num;
+int mget(char *p, int num)
 {
 	switch (num) {
 	case 1:
@@ -97,8 +92,7 @@
 	}
 }
 
-int fquad(fp)
-FILE *fp;
+int fquad(FILE *fp)
 {
 	int i,cc;
 	unsigned char fchar[4];
@@ -110,8 +104,7 @@
 	return cc;
 }
 
-unsigned int uftri(fp)
-FILE *fp;
+unsigned int uftri(FILE *fp)
 {
 	unsigned int i,cc;
 	unsigned char fchar[4];
@@ -125,8 +118,7 @@
 	return cc;
 }
 
-int ftri(fp)
-FILE *fp;
+int ftri(FILE *fp)
 {
 	int i,cc;
 	unsigned char fchar[4];
@@ -142,8 +134,7 @@
 	return cc;
 }
 
-unsigned int ufpair(fp)
-FILE *fp;
+unsigned int ufpair(FILE *fp)
 {
 	unsigned int i,cc;
 	unsigned char fchar[4];
@@ -157,8 +148,7 @@
 	return cc;
 }
 
-int fpair(fp)
-FILE *fp;
+int fpair(FILE *fp)
 {
 	int i,cc;
 	unsigned char fchar[4];
@@ -174,16 +164,12 @@
 	return cc;
 }
 
-int fskip(fp,num)
-FILE *fp;
-int num;
+int fskip(FILE *fp, int num)
 {
 	fseek(fp,num,1);
 }
 
-int fputnum(num,byte,fp)
-int num,byte;
-FILE *fp;
+int fputnum(int num, int byte, FILE *fp)
 {
 	int i,cc;
 	unsigned char buf[16];
@@ -212,8 +198,7 @@
 	return 0;
 }
 
-int numcount(num)
-int num;
+int numcount(int num)
 {
 	if (num >= 0) {
 		if (num <= 127) {
@@ -245,18 +230,13 @@
 	}
 }
 
-int fputnum2(num,fp)
-int num;
-FILE *fp;
+int fputnum2(int num, FILE *fp)
 {
 	fputnum(num,numcount(num),fp);
 	return 0;
 }
 
-int fputstr(str,byte,fp)
-char *str;
-int byte;
-FILE *fp;
+int fputstr(char *str, int byte, FILE *fp)
 {
 	int i;
 
@@ -266,8 +246,7 @@
 
 	return 0;
 }
-int cutspace(fp)
-FILE *fp;
+int cutspace(FILE *fp)
 {
 	int cc;
 
@@ -287,8 +266,7 @@
 	}
 }
 
-int gethex(fp)
-FILE *fp;
+int gethex(FILE *fp)
 {
 	int cc,i;
 	char buf[256];
@@ -312,8 +290,7 @@
 	}
 }
 
-int getdec(fp)
-FILE *fp;
+int getdec(FILE *fp)
 {
 	int cc,i;
 	char buf[256];
Index: tfmread.c
===================================================================
--- makejvf-1.1a.orig/tfmread.c
+++ makejvf-1.1a/tfmread.c
@@ -2,13 +2,14 @@
 #include <stdlib.h>
 #include <string.h>
 
+#include <kpathsea/config.h>
+#include "makejvf.h"
+
 int nt,unit,zh,zw,jfm_id;
 int *width,*height,*depth,*italic,*glue_kern,*kern,*glue,*param;
 char *header,*char_type,*char_info;
-extern int baseshift;
 
-int jfmread(kcode)
-int kcode;
+int jfmread(int kcode)
 {
 	int i,ctype = 0,w_ind,w;
 
@@ -26,8 +27,7 @@
 	return(w);
 }
 
-int tfmget(name)
-char *name;
+int tfmget(char *name)
 {
 	int i,j,cc,tsize;
 	char nbuff[1024];
@@ -51,8 +51,7 @@
 	return 0;
 }
 
-int tfmidx(fp)
-FILE *fp;
+int tfmidx(FILE *fp)
 {
 	int i,cc;
 	int lh,ec,nw,nh,nd,ni,nl,nk,ng,np;
Index: configure.ac
===================================================================
--- makejvf-1.1a.orig/configure.ac
+++ makejvf-1.1a/configure.ac
@@ -0,0 +1,28 @@
+dnl Process this file with autoconf to produce a configure script.
+dnl
+dnl   Copyright (C) 2009 Peter Breitenlohner <tex-live@tug.org>
+dnl
+dnl   This file is free software; the copyright holder
+dnl   gives unlimited permission to copy and/or distribute it,
+dnl   with or without modifications, as long as this notice is preserved.
+dnl
+AC_INIT([makejvf for TeX Live], [1.1a])
+AC_PREREQ([2.63])
+AC_CONFIG_SRCDIR([main.c])
+AC_CONFIG_AUX_DIR([../../build-aux])
+AC_CONFIG_MACRO_DIR([../../m4])
+
+dnl Common code for all programs using libkpathsea.
+KPSE_COMMON([makejvfk], [no-define])
+
+AC_CONFIG_HEADERS([c-auto.h:c-auto.in])
+
+AC_CHECK_HEADERS([strings.h])
+AC_CHECK_FUNCS([strdup strtol])
+
+KPSE_KPATHSEA_FLAGS
+KPSE_PTEXENC_FLAGS
+
+AC_CONFIG_FILES([Makefile])
+
+AC_OUTPUT
Index: main.c
===================================================================
--- makejvf-1.1a.orig/main.c
+++ makejvf-1.1a/main.c
@@ -2,18 +2,19 @@
 #include <stdlib.h>
 #include <string.h>
 
+#include <kpathsea/config.h>
+#include <ptexenc/ptexenc.h>
+#include "makejvf.h"
+
 FILE *vfp,*afp=NULL;
 char *atfmname,*vtfmname,*afmname,*vfname,*kanatfm;
 int kanatume=-1,chotai=0,baseshift=0,minute=0;
 
-FILE *vfopen();
-
-main(argc,argv)
-int argc;
-char **argv;
+int main(int argc, char ** argv)
 {
 	int i,j;
 
+	set_enc_string(NULL, "EUC");
 	if (argc < 3) {
 		usage();
 		exit(0);
@@ -121,18 +122,18 @@
 	exit(0);
 }
 
-usage()
+void usage(void)
 {
-	fprintf(stderr,"MAKEJVF ver.1.1a -- make Japanese VF file.\n");
-	fprintf(stderr,"%% makejvf [<options>] <TFMfile> <PSfontTFM>\n");
-	fprintf(stderr,"options:\n");
-	fprintf(stderr,"-C           長体モード\n");
-	fprintf(stderr,"-K <TFMfile> 非漢字部用に作成するPSフォントTFM名\n");
-	fprintf(stderr,"-b <数値>    ベースライン補正\n");
-	fprintf(stderr,"             文字の高さを1000として整数で指定\n");
-	fprintf(stderr,"             プラスで文字が下がり、マイナスで文字が上がる\n");
-	fprintf(stderr,"-m           縦書き時にクオート(’”)の代わりにミニュート(′″)を使用\n");
-	fprintf(stderr,"-a <AFMfile> AFMファイル名（かな詰め時に使用）\n");
-	fprintf(stderr,"-k <数値>    かな詰めマージン指定\n");
-	fprintf(stderr,"             文字幅を1000として整数で指定。-aオプションと共に使用\n");
+	fputs2("MAKEJVF ver.1.1a -- make Japanese VF file.\n", stderr);
+	fputs2("%% makejvf [<options>] <TFMfile> <PSfontTFM>\n", stderr);
+	fputs2("options:\n", stderr);
+	fputs2("-C           長体モード\n", stderr);
+	fputs2("-K <TFMfile> 非漢字部用に作成するPSフォントTFM名\n", stderr);
+	fputs2("-b <数値>    ベースライン補正\n", stderr);
+	fputs2("             文字の高さを1000として整数で指定\n", stderr);
+	fputs2("             プラスで文字が下がり、マイナスで文字が上がる\n", stderr);
+	fputs2("-m           縦書き時にクオート(’”)の代わりにミニュート(′″)を使用\n", stderr);
+	fputs2("-a <AFMfile> AFMファイル名（かな詰め時に使用）\n", stderr);
+	fputs2("-k <数値>    かな詰めマージン指定\n", stderr);
+	fputs2("             文字幅を1000として整数で指定。-aオプションと共に使用\n", stderr);
 }
Index: makejvf.h
===================================================================
--- makejvf-1.1a.orig/makejvf.h
+++ makejvf-1.1a/makejvf.h
@@ -0,0 +1,31 @@
+
+
+extern char *vtfmname,*kanatfm;
+extern int unit,zh,zw,jfm_id;
+extern int kanatume,chotai,baseshift,minute;
+extern FILE *afp;
+
+/* main.c */
+void usage(void);
+
+/* tfmread.c */
+int jfmread(int kcode);
+int tfmget(char *name);
+int tfmidx(FILE *fp);
+
+/* tool.c */
+int mquad(unsigned char *p);
+unsigned int upair(unsigned char *p);
+int fquad(FILE *fp);
+unsigned int ufpair(FILE *fp);
+int fpair(FILE *fp);
+int fputnum(int num, int byte, FILE *fp);
+int numcount(int num);
+int fputnum2(int num, FILE *fp);
+int fputstr(char *str, int byte, FILE *fp);
+
+/* write.c */
+FILE *vfopen(char *name);
+void writevf(int code, FILE *fp);
+int vfclose(FILE *fp);
+int maketfm(char *name);
Index: Makefile.am
===================================================================
--- makejvf-1.1a.orig/Makefile.am
+++ makejvf-1.1a/Makefile.am
@@ -1,38 +1,27 @@
-## Makefile.am for the TeX Live subdirectory texk/makeindexk/
+## Makefile.am for the TeX Live subdirectory texk/makejvfk/
 ##
 ## Copyright (C) 2009 Peter Breitenlohner <tex-live@tug.org>
 ## You may freely use, modify and/or distribute this file.
 ##
 ACLOCAL_AMFLAGS = -I ../../m4
 
-INCLUDES = $(KPATHSEA_INCLUDES)
-AM_CPPFLAGS = -DUNIX -DKPATHSEA
+INCLUDES = $(KPATHSEA_INCLUDES) $(PTEXENC_INCLUDES)
 AM_CFLAGS = $(WARNING_CFLAGS)
 
-dist_bin_SCRIPTS = mkindex
 
-bin_PROGRAMS = makeindex
+bin_PROGRAMS = makejvf
 
-makeindex_SOURCES = \
-	genind.c \
-	genind.h \
-	mkind.c \
-	mkind.h \
-	qsort.c \
-	scanid.c \
-	scanid.h \
-	scanst.c \
-	scanst.h \
-	sortid.c
+makejvf_SOURCES = \
+	main.c  makejvf.h  tfmread.c  tool.c  write.c
 
-makeindex_DEPENDENCIES = $(KPATHSEA_DEPEND)
+makejvf_DEPENDENCIES = $(KPATHSEA_DEPEND) $(PTEXENC_DEPEND)
 
-LDADD = $(KPATHSEA_LIBS)	
+LDADD = $(PTEXENC_LIBS) $(KPATHSEA_LIBS)
 
-## Rebuild libkpathsea
+## Rebuild libkpathsea & libptexenc
 @KPATHSEA_RULE@
+@PTEXENC_RULE@
 
-dist_man1_MANS = makeindex.1 mkindex.1
 
-EXTRA_DIST = ACK CONTRIB FILES NOTES PORTING
+EXTRA_DIST = COPYRIGHT COPYRIGHT.jis Changes.txt README.txt
 
Index: write.c
===================================================================
--- makejvf-1.1a.orig/write.c
+++ makejvf-1.1a/write.c
@@ -1,13 +1,10 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-extern char *vtfmname,*kanatfm;
-extern int unit,zh,zw,jfm_id;
-extern int kanatume,chotai,baseshift,minute;
-extern FILE *afp;
+#include <kpathsea/config.h>
+#include "makejvf.h"
 
-FILE *vfopen(name)
-char *name;
+FILE *vfopen(char *name)
 {
 	FILE *fp;
 
@@ -52,9 +49,7 @@
 	return fp;
 }
 
-writevf(code,fp)
-int code;
-FILE *fp;
+void writevf(int code, FILE *fp)
 {
 	int cc,cc2,cc3,cc4,w,skip=0,skip2=0,height;
 	char buf[256],buf2[256];
@@ -341,8 +336,7 @@
 	fputnum(code,2,fp); /* char code */
 }
 
-int vfclose(fp)
-FILE *fp;
+int vfclose(FILE *fp)
 {
 	int i,cc;
 
@@ -353,8 +347,7 @@
 	fclose(fp);
 }
 
-int maketfm(name)
-char *name;
+int maketfm(char *name)
 {
 	char nbuf[256];
 	FILE *fp;
Index: aclocal.m4
===================================================================
--- makejvf-1.1a.orig/aclocal.m4
+++ makejvf-1.1a/aclocal.m4
@@ -991,6 +991,7 @@
 
 m4_include([../../m4/kpse-common.m4])
 m4_include([../../m4/kpse-kpathsea-flags.m4])
+m4_include([../../m4/kpse-ptexenc-flags.m4])
 m4_include([../../m4/kpse-warnings.m4])
 m4_include([../../m4/libtool.m4])
 m4_include([../../m4/ltoptions.m4])
